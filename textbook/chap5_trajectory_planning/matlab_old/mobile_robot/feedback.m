function u_tilde = feedback(u,P)

    % process inputs to function
    pn_d       = u(1);       % inertial North position     
    pe_d       = u(2);       % inertial East position
    V_d        = u(3);       % robot forward speed
    psi_d      = u(4);       % heading angle     
    pn         = u(5);       % inertial North position     
    pe         = u(6);       % inertial East position
    V          = u(7);       % robot forward speed
    psi        = u(8);       % heading angle     
    
    x_tilde = [...
        pn - pn_d;...
        pe - pe_d;...
        V - V_d;...
        unwrap(psi - psi_d);...
        ];
    
    % place poles of time-varying system so that they are time-invariant
    A = [...
        0, 0, cos(psi_d), -V_d*sin(psi_d);...
        0, 0, sin(psi_d), V_d*cos(psi_d);...
        0, 0, 0, 0;...
        0, 0, 0, 0;...
        ];
    B = [...
        0, 0;...
        0, 0;...
        1, 0;...
        0, 1;...
        ];
    poles = 1*[-1-j, -1+j, -2, -1.5];
    K = place(A,B,poles);
    
    u_tilde = -K*x_tilde;
    %u_tilde = [0; 0];
end

function out = unwrap(in)
  out = in;
  while out>pi,
      out = out - 2*pi;
  end
  while out<-pi,
      out = out + 2*pi;
  end
end
